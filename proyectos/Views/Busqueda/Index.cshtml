@model IEnumerable<HotelesCaribe.Models.VwBusquedaHospedaje>

@{
    ViewData["Title"] = "Resultados de búsqueda";
}

@section Styles {
    <link rel="stylesheet" href="~/css/busqueda.css" asp-append-version="true" />
}

<div class="barra-busqueda-resultados">
    <form method="get" action="@Url.Action("Index", "Busqueda")" class="d-flex w-100">
        <input type="text" name="ubicacion" class="busqueda-input" value="@ViewBag.Ubicacion" placeholder="Puerto Viejo, Limón" />

        <input type="text" name="nombreHotel" class="busqueda-input-nombre" value="@ViewBag.NombreHotel" placeholder="Nombre del hotel..." />

        <input type="hidden" name="tipoHospedaje" value="@ViewBag.TipoHospedaje" />

        <div class="iconos-busqueda">
            <div class="filtro-icono" onclick="toggleFiltros()">
                <i class="fas fa-filter"></i>
            </div>
            <button type="submit" class="btn-transparente busqueda-icono">
                <i class="fas fa-search"></i>
            </button>
        </div>
    </form>

    <div id="panel-filtros" class="panel-filtros-flotante" style="display: none;">
        <div class="filtros-header">
            <h4><i class="fas fa-sliders-h"></i> Filtros</h4>
            <button class="btn-cerrar-filtros" onclick="toggleFiltros()">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <div class="filtros-content">
            <div class="filtros-row">
                <div class="filtro-compacto">
                    <label><i class="fas fa-map-marked-alt"></i> Provincia</label>
                    <select class="filtro-select-small">
                        <option value="">Todas</option>
                        <option value="Limón">Limón</option>
                        <option value="San José">San José</option>
                        <option value="Puntarenas">Puntarenas</option>
                        <option value="Guanacaste">Guanacaste</option>
                    </select>
                </div>

                <div class="filtro-compacto">
                    <label><i class="fas fa-money-bill-wave"></i> Precio máx.</label>
                    <select class="filtro-select-small">
                        <option value="">Sin límite</option>
                        <option value="25000">₡25,000</option>
                        <option value="50000">₡50,000</option>
                        <option value="100000">₡100,000</option>
                    </select>
                </div>
            </div>

            <div class="filtros-row">
                <div class="servicios-compactos">
                    <label><i class="fas fa-concierge-bell"></i> Servicios</label>
                    <div class="servicios-pills">
                        <span class="servicio-pill" onclick="toggleServicio(this)" data-servicio="wifi">
                            <i class="fas fa-wifi"></i> WiFi
                        </span>
                        <span class="servicio-pill" onclick="toggleServicio(this)" data-servicio="piscina">
                            <i class="fas fa-swimming-pool"></i> Piscina
                        </span>
                        <span class="servicio-pill" onclick="toggleServicio(this)" data-servicio="aire">
                            <i class="fas fa-snowflake"></i> A/C
                        </span>
                        <span class="servicio-pill" onclick="toggleServicio(this)" data-servicio="parking">
                            <i class="fas fa-parking"></i> Parking
                        </span>
                        <span class="servicio-pill" onclick="toggleServicio(this)" data-servicio="playa">
                            <i class="fas fa-umbrella-beach"></i> Playa
                        </span>
                    </div>
                </div>
            </div>

            <div class="filtros-row">
                <div class="rating-compacto">
                    <label><i class="fas fa-star"></i> Valoración mín.</label>
                    <div class="rating-pills">
                        <span class="rating-pill active" onclick="setRatingCompact(this, 0)">Todas</span>
                        <span class="rating-pill" onclick="setRatingCompact(this, 3)">★★★+</span>
                        <span class="rating-pill" onclick="setRatingCompact(this, 4)">★★★★+</span>
                        <span class="rating-pill" onclick="setRatingCompact(this, 5)">★★★★★</span>
                    </div>
                </div>
            </div>

            <div class="filtros-acciones-compactas">
                <button type="button" class="btn-limpiar-compacto" onclick="limpiarFiltros()">
                    <i class="fas fa-undo"></i> Limpiar
                </button>
                <button type="button" class="btn-aplicar-compacto" onclick="aplicarFiltros()">
                    <i class="fas fa-search"></i> Aplicar
                </button>
            </div>
        </div>
    </div>

    <div id="filtros-overlay" class="filtros-overlay" onclick="toggleFiltros()" style="display: none;"></div>
</div>


@if (!string.IsNullOrEmpty(ViewBag.NombreHotel))
{
    <div class="info-busqueda">
        <p><strong>Buscando hoteles con nombre:</strong> "@ViewBag.NombreHotel"</p>
        <p><strong>Resultados encontrados:</strong> @ViewBag.TotalResultados</p>
        <a href="@Url.Action("Index", "Busqueda", new { ubicacion = ViewBag.Ubicacion, tipoHospedaje = ViewBag.TipoHospedaje })"
           class="limpiar-busqueda">
            <i class="fas fa-times"></i> Limpiar búsqueda por nombre
        </a>
    </div>
}

<div class="categorias-hospedaje">
    <a href="@Url.Action("Index", "Busqueda", new { ubicacion = ViewBag.Ubicacion, tipoHospedaje = "Hotel", nombreHotel = ViewBag.NombreHotel })"
       class="categoria-item @(ViewBag.TipoHospedaje == "Hotel" ? "active" : "")">
        <i class="fas fa-building"></i>
        <span>Hotel</span>
    </a>
    <a href="@Url.Action("Index", "Busqueda", new { ubicacion = ViewBag.Ubicacion, tipoHospedaje = "Hostel", nombreHotel = ViewBag.NombreHotel })"
       class="categoria-item @(ViewBag.TipoHospedaje == "Hostel" ? "active" : "")">
        <i class="fas fa-bed"></i>
        <span>Hostel</span>
    </a>
    <a href="@Url.Action("Index", "Busqueda", new { ubicacion = ViewBag.Ubicacion, tipoHospedaje = "Casa", nombreHotel = ViewBag.NombreHotel })"
       class="categoria-item @(ViewBag.TipoHospedaje == "Casa" ? "active" : "")">
        <i class="fas fa-home"></i>
        <span>Casa</span>
    </a>
    <a href="@Url.Action("Index", "Busqueda", new { ubicacion = ViewBag.Ubicacion, tipoHospedaje = "Departamento", nombreHotel = ViewBag.NombreHotel })"
       class="categoria-item @(ViewBag.TipoHospedaje == "Departamento" ? "active" : "")">
        <i class="fas fa-city"></i>
        <span>Departamento</span>
    </a>
    <a href="@Url.Action("Index", "Busqueda", new { ubicacion = ViewBag.Ubicacion, tipoHospedaje = "Cuarto compartido", nombreHotel = ViewBag.NombreHotel })"
       class="categoria-item @(ViewBag.TipoHospedaje == "Cuarto compartido" ? "active" : "")">
        <i class="fas fa-users"></i>
        <span>Cuarto compartido</span>
    </a>
    <a href="@Url.Action("Index", "Busqueda", new { ubicacion = ViewBag.Ubicacion, tipoHospedaje = "Cabaña", nombreHotel = ViewBag.NombreHotel })"
       class="categoria-item @(ViewBag.TipoHospedaje == "Cabaña" ? "active" : "")">
        <i class="fas fa-campground"></i>
        <span>Cabaña</span>
    </a>
</div>

<!-- Resultados de la búsqueda -->
<div class="resultados-grid">
    @if (Model != null && Model.Any())
    {
        foreach (var hotel in Model)
        {
            <div class="resultado-card">
                <!-- Header con icono y nombre del hotel -->
                <div class="hotel-header">
                    <div class="hotel-badge">
                        <i class="fas fa-hotel"></i>
                        <span class="hotel-nombre">@hotel.NombreHotel</span>
                    </div>
                </div>

                <!-- Imagen del hotel -->
                <div class="hotel-imagen-container">
                    <img src="/img/hotel-default.jpg" alt="@hotel.NombreHotel" class="hotel-img">
                    <div class="imagen-overlay"></div>
                </div>

                <!-- Información del hotel -->
                <div class="hotel-info">
                    <div class="ubicacion-info">
                        <div class="ubicacion-principal">
                            <i class="fas fa-map-marker-alt"></i>
                            <span class="ubicacion-texto">@hotel.Provincia, @hotel.Canton, @hotel.Distrito</span>
                        </div>
                        <div class="ubicacion-detalle">@hotel.Distrito</div>
                    </div>


                </div>

                <!-- Botón de acción -->
                <div class="hotel-acciones">
                    <a asp-controller="Hospedaje" asp-action="Detalles" asp-route-id="@hotel.IdEmpresaHospedaje"
                           class="btn-ver-mas">
                        <span>Ver más</span>
                        <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
            </div>
        }
    }
    else
    {
        <div class="no-resultados">
            @if (!string.IsNullOrEmpty(ViewBag.NombreHotel))
            {
                <p>No se encontraron hoteles con el nombre "@ViewBag.NombreHotel".</p>
                <p>Verifica la ortografía o intenta con otro nombre.</p>
            }
            else
            {
                <p>No se encontraron resultados para tu búsqueda.</p>
                <p>Prueba con otras palabras clave o filtros.</p>
            }
        </div>
    }
</div>

<!-- Paginación -->
<div class="paginacion">
    <button class="btn-pagina prev">
        <i class="fas fa-chevron-left"></i>
    </button>
    <span class="info-pagina">Página 1 de 1</span>
    <button class="btn-pagina next">
        <i class="fas fa-chevron-right"></i>
    </button>
</div>

<script>
    // Funciones para el panel de filtros
    function toggleFiltros() {
        const panel = document.getElementById('panel-filtros');
        const overlay = document.getElementById('filtros-overlay');
        const icono = document.querySelector('.filtro-icono');

        if (panel && overlay) {
            const isVisible = panel.style.display === 'block';

            if (isVisible) {
                // Cerrar con animación
                panel.style.opacity = '0';
                panel.style.transform = 'translate(-50%, -50%) scale(0.8)';
                overlay.style.opacity = '0';

                // Ocultar después de la animación
                setTimeout(() => {
                    panel.style.display = 'none';
                    overlay.style.display = 'none';
                }, 300);

                icono?.classList.remove('active');
                console.log('❌ Panel cerrado');
            } else {
                // Mostrar y animar entrada
                panel.style.display = 'block';
                overlay.style.display = 'block';

                // Forzar reflow
                panel.offsetHeight;

                // Animar entrada
                panel.style.opacity = '1';
                panel.style.transform = 'translate(-50%, -50%) scale(1)';
                overlay.style.opacity = '1';

                icono?.classList.add('active');
                console.log('✅ Panel abierto');
            }
        }
    }

    // Limpiar estados al cargar
    document.addEventListener('DOMContentLoaded', function() {
        const panel = document.getElementById('panel-filtros');
        const overlay = document.getElementById('filtros-overlay');

        if (panel) {
            panel.style.display = 'none';
            panel.style.opacity = '0';
            panel.style.transform = 'translate(-50%, -50%) scale(0.8)';
        }
        if (overlay) {
            overlay.style.display = 'none';
            overlay.style.opacity = '0';
        }

        console.log('🎯 Filtros inicializados correctamente');
    });

    function toggleServicio(element) {
        element.classList.toggle('active');
    }

    function setRatingCompact(element, rating) {
        // Limpiar otras selecciones
        document.querySelectorAll('.rating-pill').forEach(pill => pill.classList.remove('active'));
        element.classList.add('active');
    }

    function limpiarFiltros() {
        // Limpiar selects
        document.querySelectorAll('.filtro-select-small').forEach(select => select.selectedIndex = 0);

        // Limpiar servicios
        document.querySelectorAll('.servicio-pill.active').forEach(pill => pill.classList.remove('active'));

        // Limpiar rating
        document.querySelectorAll('.rating-pill.active').forEach(pill => pill.classList.remove('active'));

        console.log('Filtros limpiados');
    }

    function aplicarFiltros() {
        // Recopilar filtros seleccionados
        const provincia = document.querySelector('.filtro-select-small').value;
        const precioMax = document.querySelectorAll('.filtro-select-small')[1].value;
        const servicios = Array.from(document.querySelectorAll('.servicio-pill.active')).map(pill => pill.dataset.servicio);
        const ratingElement = document.querySelector('.rating-pill.active');
        const rating = ratingElement ? ratingElement.textContent.trim() : null;

        console.log('Aplicando filtros:', {
            provincia,
            precioMax,
            servicios,
            rating
        });

        // Cerrar panel
        toggleFiltros();

        // Aquí harías la búsqueda con los filtros
        alert('Filtros aplicados! (Funcionalidad no implementada aún)');
    }

    // Cerrar filtros con ESC
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            const panel = document.getElementById('panel-filtros');
            if (panel.classList.contains('active')) {
                toggleFiltros();
            }
        }
    });
</script>